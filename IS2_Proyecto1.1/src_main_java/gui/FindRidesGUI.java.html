<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>FindRidesGUI.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">CreateReservationDBWhiteTest (2 oct 2025 18:05:28)</a> &gt; <a href="../../index.html" class="el_group">IS2_Proyecto1.1</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">gui</a> &gt; <span class="el_source">FindRidesGUI.java</span></div><h1>FindRidesGUI.java</h1><pre class="source lang-java linenums">package gui;

import configuration.UtilDate;

import com.toedter.calendar.JCalendar;

import businesslogic.BLFacade;
import domain.Ride;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.text.DateFormat;
import java.util.*;
import java.util.List;

import javax.swing.table.DefaultTableModel;


public class FindRidesGUI extends JFrame {
	private static final long serialVersionUID = 1L;


<span class="nc" id="L24">	private JComboBox&lt;String&gt; jComboBoxOrigin = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L25">	DefaultComboBoxModel&lt;String&gt; originLocations = new DefaultComboBoxModel&lt;String&gt;();</span>

<span class="nc" id="L27">	private JComboBox&lt;String&gt; jComboBoxDestination = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L28">	DefaultComboBoxModel&lt;String&gt; destinationCities = new DefaultComboBoxModel&lt;String&gt;();</span>

<span class="nc" id="L30">	private JLabel jLabelOrigin = new JLabel(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;CreateRideGUI.LeavingFrom&quot;));</span>
<span class="nc" id="L31">	private JLabel jLabelDestination = new JLabel(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;CreateRideGUI.GoingTo&quot;));</span>
<span class="nc" id="L32">	private final JLabel jLabelEventDate = new JLabel(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;CreateRideGUI.RideDate&quot;));</span>
<span class="nc" id="L33">	private final JLabel jLabelEvents = new JLabel(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;CreateRideGUI.Rides&quot;)); </span>

<span class="nc" id="L35">	private JButton jButtonClose = new JButton(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;Close&quot;));</span>

	// Code for JCalendar
<span class="nc" id="L38">	private JCalendar jCalendar1 = new JCalendar();</span>
<span class="nc" id="L39">	private Calendar calendarAnt = null;</span>
<span class="nc" id="L40">	private Calendar calendarAct = null;</span>
<span class="nc" id="L41">	private JScrollPane scrollPaneEvents = new JScrollPane();</span>

<span class="nc" id="L43">	private List&lt;Date&gt; datesWithRidesCurrentMonth = new Vector&lt;Date&gt;();</span>

<span class="nc" id="L45">	private JTable tableRides= new JTable();</span>

	private DefaultTableModel tableModelRides;


<span class="nc" id="L50">	private String[] columnNamesRides = new String[] {</span>
<span class="nc" id="L51">			ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.Driver&quot;), </span>
<span class="nc" id="L52">			ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.NPlaces&quot;), </span>
<span class="nc" id="L53">			ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.Price&quot;)</span>
	};


<span class="nc" id="L57">	public FindRidesGUI()</span>
	{

<span class="nc" id="L60">		this.getContentPane().setLayout(null);</span>
<span class="nc" id="L61">		this.setSize(new Dimension(700, 500));</span>
<span class="nc" id="L62">		this.setTitle(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.FindRides&quot;));</span>

<span class="nc" id="L64">		jLabelEventDate.setBounds(new Rectangle(457, 6, 140, 25));</span>
<span class="nc" id="L65">		jLabelEvents.setBounds(172, 229, 259, 16);</span>

<span class="nc" id="L67">		this.getContentPane().add(jLabelEventDate, null);</span>
<span class="nc" id="L68">		this.getContentPane().add(jLabelEvents);</span>

<span class="nc" id="L70">		jButtonClose.setBounds(new Rectangle(274, 419, 130, 30));</span>

<span class="nc" id="L72">		jButtonClose.addActionListener(new ActionListener()</span>
		{
			public void actionPerformed(ActionEvent e)
			{
<span class="nc" id="L76">				jButton2_actionPerformed(e);</span>
<span class="nc" id="L77">			}</span>
		});
<span class="nc" id="L79">		BLFacade facade = MainGUI.getBusinessLogic();</span>
<span class="nc" id="L80">		List&lt;String&gt; origins=facade.getDepartCities();</span>
		
<span class="nc bnc" id="L82" title="All 2 branches missed.">		for(String location:origins) originLocations.addElement(location);</span>
		
<span class="nc" id="L84">		jLabelOrigin.setBounds(new Rectangle(6, 56, 92, 20));</span>
<span class="nc" id="L85">		jLabelDestination.setBounds(6, 81, 61, 16);</span>
<span class="nc" id="L86">		getContentPane().add(jLabelOrigin);</span>

<span class="nc" id="L88">		getContentPane().add(jLabelDestination);</span>

<span class="nc" id="L90">		jComboBoxOrigin.setModel(originLocations);</span>
<span class="nc" id="L91">		jComboBoxOrigin.setBounds(new Rectangle(103, 50, 172, 20));</span>
		

<span class="nc" id="L94">		List&lt;String&gt; aCities=facade.getDestinationCities((String)jComboBoxOrigin.getSelectedItem());</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		for(String aciti:aCities) {</span>
<span class="nc" id="L96">			destinationCities.addElement(aciti);</span>
		}
		
<span class="nc" id="L99">		jComboBoxOrigin.addItemListener(new ItemListener() {</span>
			public void itemStateChanged(ItemEvent e) {
<span class="nc" id="L101">				destinationCities.removeAllElements();</span>
<span class="nc" id="L102">				BLFacade facade = MainGUI.getBusinessLogic();</span>

<span class="nc" id="L104">				List&lt;String&gt; aCities=facade.getDestinationCities((String)jComboBoxOrigin.getSelectedItem());</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">				for(String aciti:aCities) {</span>
<span class="nc" id="L106">					destinationCities.addElement(aciti);</span>
				}
<span class="nc" id="L108">				tableModelRides.getDataVector().removeAllElements();</span>
<span class="nc" id="L109">				tableModelRides.fireTableDataChanged();</span>

				
<span class="nc" id="L112">			}</span>
		});


<span class="nc" id="L116">		jComboBoxDestination.setModel(destinationCities);</span>
<span class="nc" id="L117">		jComboBoxDestination.setBounds(new Rectangle(103, 80, 172, 20));</span>
<span class="nc" id="L118">		jComboBoxDestination.addItemListener(new ItemListener() {</span>
			public void itemStateChanged(ItemEvent e) {

<span class="nc" id="L121">				paintDaysWithEvents(jCalendar1,datesWithRidesCurrentMonth,	new Color(210,228,238));</span>

<span class="nc" id="L123">				BLFacade facade = MainGUI.getBusinessLogic();</span>

<span class="nc" id="L125">				datesWithRidesCurrentMonth=facade.getThisMonthDatesWithRides((String)jComboBoxOrigin.getSelectedItem(),(String)jComboBoxDestination.getSelectedItem(),jCalendar1.getDate());</span>
<span class="nc" id="L126">				paintDaysWithEvents(jCalendar1,datesWithRidesCurrentMonth,Color.CYAN);</span>

<span class="nc" id="L128">			}</span>
		});

<span class="nc" id="L131">		this.getContentPane().add(jButtonClose, null);</span>
<span class="nc" id="L132">		this.getContentPane().add(jComboBoxOrigin, null);</span>

<span class="nc" id="L134">		this.getContentPane().add(jComboBoxDestination, null);</span>


<span class="nc" id="L137">		jCalendar1.setBounds(new Rectangle(300, 50, 225, 150));</span>


		// Code for JCalendar
<span class="nc" id="L141">		jCalendar1.addPropertyChangeListener(new PropertyChangeListener()</span>
		{
			public void propertyChange(PropertyChangeEvent propertychangeevent)
			{

<span class="nc bnc" id="L146" title="All 2 branches missed.">				if (propertychangeevent.getPropertyName().equals(&quot;locale&quot;))</span>
				{
<span class="nc" id="L148">					jCalendar1.setLocale((Locale) propertychangeevent.getNewValue());</span>
<span class="nc" id="L149">				}</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">				else if (propertychangeevent.getPropertyName().equals(&quot;calendar&quot;))</span>
				{
<span class="nc" id="L152">					calendarAnt = (Calendar) propertychangeevent.getOldValue();</span>
<span class="nc" id="L153">					calendarAct = (Calendar) propertychangeevent.getNewValue();</span>
					

					
<span class="nc" id="L157">					DateFormat dateformat1 = DateFormat.getDateInstance(1, jCalendar1.getLocale());</span>

<span class="nc" id="L159">					int monthAnt = calendarAnt.get(Calendar.MONTH);</span>
<span class="nc" id="L160">					int monthAct = calendarAct.get(Calendar.MONTH);</span>

<span class="nc bnc" id="L162" title="All 2 branches missed.">					if (monthAct!=monthAnt) {</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">						if (monthAct==monthAnt+2) {</span>
							// Si en JCalendar está 30 de enero y se avanza al mes siguiente, devolvería 2 de marzo (se toma como equivalente a 30 de febrero)
							// Con este código se dejará como 1 de febrero en el JCalendar
<span class="nc" id="L166">							calendarAct.set(Calendar.MONTH, monthAnt+1);</span>
<span class="nc" id="L167">							calendarAct.set(Calendar.DAY_OF_MONTH, 1);</span>
						}						

<span class="nc" id="L170">						jCalendar1.setCalendar(calendarAct);</span>

					}
					
					try {
<span class="nc" id="L175">						tableModelRides.setDataVector(null, columnNamesRides);</span>
<span class="nc" id="L176">						tableModelRides.setColumnCount(4); // another column added to allocate ride objects</span>

<span class="nc" id="L178">						BLFacade facade = MainGUI.getBusinessLogic();</span>
<span class="nc" id="L179">						List&lt;domain.Ride&gt; rides=facade.getRides((String)jComboBoxOrigin.getSelectedItem(),(String)jComboBoxDestination.getSelectedItem(),UtilDate.trim(jCalendar1.getDate()));</span>

<span class="nc bnc" id="L181" title="All 2 branches missed.">						if (rides.isEmpty() ) jLabelEvents.setText(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.NoRides&quot;)+ &quot;: &quot;+dateformat1.format(calendarAct.getTime()));</span>
<span class="nc" id="L182">						else jLabelEvents.setText(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;FindRidesGUI.Rides&quot;)+ &quot;: &quot;+dateformat1.format(calendarAct.getTime()));</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">						for (domain.Ride ride:rides){</span>
<span class="nc" id="L184">							Vector&lt;Object&gt; row = new Vector&lt;Object&gt;();</span>
<span class="nc" id="L185">							row.add(ride.getDriver().getName());</span>
<span class="nc" id="L186">							row.add(ride.getnPlaces());</span>
<span class="nc" id="L187">							row.add(ride.getPrice());</span>
<span class="nc" id="L188">							row.add(ride); // ev object added in order to obtain it with tableModelEvents.getValueAt(i,3)</span>
<span class="nc" id="L189">							tableModelRides.addRow(row);		</span>
						}
<span class="nc" id="L191">						datesWithRidesCurrentMonth=facade.getThisMonthDatesWithRides((String)jComboBoxOrigin.getSelectedItem(),(String)jComboBoxDestination.getSelectedItem(),jCalendar1.getDate());</span>
<span class="nc" id="L192">						paintDaysWithEvents(jCalendar1,datesWithRidesCurrentMonth,Color.CYAN);</span>


<span class="nc" id="L195">					} catch (Exception e1) {</span>

<span class="nc" id="L197">						e1.printStackTrace();</span>
					}
<span class="nc" id="L199">					tableRides.getColumnModel().getColumn(0).setPreferredWidth(170);</span>
<span class="nc" id="L200">					tableRides.getColumnModel().getColumn(1).setPreferredWidth(30);</span>
<span class="nc" id="L201">					tableRides.getColumnModel().getColumn(1).setPreferredWidth(30);</span>
<span class="nc" id="L202">					tableRides.getColumnModel().removeColumn(tableRides.getColumnModel().getColumn(3)); // not shown in JTable</span>

				}
<span class="nc" id="L205">			} </span>
			
		});

<span class="nc" id="L209">		this.getContentPane().add(jCalendar1, null);</span>

<span class="nc" id="L211">		scrollPaneEvents.setBounds(new Rectangle(172, 257, 346, 150));</span>

<span class="nc" id="L213">		scrollPaneEvents.setViewportView(tableRides);</span>
<span class="nc" id="L214">		tableModelRides = new DefaultTableModel(null, columnNamesRides);</span>

<span class="nc" id="L216">		tableRides.setModel(tableModelRides);</span>

<span class="nc" id="L218">		tableModelRides.setDataVector(null, columnNamesRides);</span>
<span class="nc" id="L219">		tableModelRides.setColumnCount(4); // another column added to allocate ride objects</span>

<span class="nc" id="L221">		tableRides.getColumnModel().getColumn(0).setPreferredWidth(170);</span>
<span class="nc" id="L222">		tableRides.getColumnModel().getColumn(1).setPreferredWidth(30);</span>
<span class="nc" id="L223">		tableRides.getColumnModel().getColumn(1).setPreferredWidth(30);</span>

<span class="nc" id="L225">		tableRides.getColumnModel().removeColumn(tableRides.getColumnModel().getColumn(3)); // not shown in JTable</span>

<span class="nc" id="L227">		this.getContentPane().add(scrollPaneEvents, null);</span>
<span class="nc" id="L228">		datesWithRidesCurrentMonth=facade.getThisMonthDatesWithRides((String)jComboBoxOrigin.getSelectedItem(),(String)jComboBoxDestination.getSelectedItem(),jCalendar1.getDate());</span>
<span class="nc" id="L229">		paintDaysWithEvents(jCalendar1,datesWithRidesCurrentMonth,Color.CYAN);</span>

<span class="nc" id="L231">	}</span>
	public static void paintDaysWithEvents(JCalendar jCalendar,List&lt;Date&gt; datesWithEventsCurrentMonth, Color color) {
		//		// For each day with events in current month, the background color for that day is changed to cyan.


<span class="nc" id="L236">		Calendar calendar = jCalendar.getCalendar();</span>

<span class="nc" id="L238">		int month = calendar.get(Calendar.MONTH);</span>
<span class="nc" id="L239">		int today=calendar.get(Calendar.DAY_OF_MONTH);</span>
<span class="nc" id="L240">		int year=calendar.get(Calendar.YEAR);</span>

<span class="nc" id="L242">		calendar.set(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L243">		int offset = calendar.get(Calendar.DAY_OF_WEEK);</span>
<span class="nc" id="L244">		offset += 5;</span>


<span class="nc bnc" id="L247" title="All 2 branches missed.">		for (Date d:datesWithEventsCurrentMonth){</span>

<span class="nc" id="L249">			calendar.setTime(d);</span>


			// Obtain the component of the day in the panel of the DayChooser of the
			// JCalendar.
			// The component is located after the decorator buttons of &quot;Sun&quot;, &quot;Mon&quot;,... or
			// &quot;Lun&quot;, &quot;Mar&quot;...,
			// the empty days before day 1 of month, and all the days previous to each day.
			// That number of components is calculated with &quot;offset&quot; and is different in
			// English and Spanish
			//			    		  Component o=(Component) jCalendar.getDayChooser().getDayPanel().getComponent(i+offset);; 
<span class="nc" id="L260">			Component o = (Component) jCalendar.getDayChooser().getDayPanel()</span>
<span class="nc" id="L261">					.getComponent(calendar.get(Calendar.DAY_OF_MONTH) + offset);</span>
<span class="nc" id="L262">			o.setBackground(color);</span>
		}

<span class="nc" id="L265">		calendar.set(Calendar.DAY_OF_MONTH, today);</span>
<span class="nc" id="L266">		calendar.set(Calendar.MONTH, month);</span>
<span class="nc" id="L267">		calendar.set(Calendar.YEAR, year);</span>


<span class="nc" id="L270">	}</span>
	private void jButton2_actionPerformed(ActionEvent e) {
<span class="nc" id="L272">		this.setVisible(false);</span>
<span class="nc" id="L273">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span>CreateReservationDBWhiteTest (2 oct 2025 18:05:28)</div></body></html>